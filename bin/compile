#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e

build_dir=$1
cache_caddy="$2/caddy"
caddy_url="https://caddyserver.com/api/download?os=linux&arch=amd64"


if [ -f "$cache_caddy" ]; then
    echo "Found in cache."
else
    echo "Need to download again."
    curl $caddy_url --output $cache_caddy
fi

cp $cache_caddy $build_dir/caddy
caddy_version=$($build_dir/caddy -version)
echo "-----> Installed ${caddy_version} to /app/bin"

exit 0
